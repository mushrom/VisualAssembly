<!doctype html>

<!--
  Major Programming Assignment (Part 4)
  
-->

<head>
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<style>body { position: relative; }</style>
</head>
<body>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<div class="container">
    <div class="row">
        <div class="col-4">
            <nav id="navbar-example3" class="navbar navbar-light bg-light flex-column align-items-stretch p-3">
              <a class="navbar-brand" href="#">Manual index</a>
              <nav class="nav nav-pills flex-column">
                <a class="nav-link" href="#overview">Overview</a>
                <nav class="nav nav-pills flex-column">
                  <a class="nav-link ms-3 my-1" href="#interface">Interface</a>
                  <a class="nav-link ms-3 my-1" href="#virtual-machine">Virtual Machine</a>
                </nav>

                <nav class="nav nav-pills flex-column">
                  <a class="nav-link" href="#instructions">Instruction reference</a>
                  <a class="nav-link ms-3 my-1" href="#push">push</a>
                  <a class="nav-link ms-3 my-1" href="#pop">pop</a>
                  <a class="nav-link ms-3 my-1" href="#move">move</a>
                  <a class="nav-link ms-3 my-1" href="#call">call</a>
                  <a class="nav-link ms-3 my-1" href="#jump">jump</a>
                  <a class="nav-link ms-3 my-1" href="#jump-zero">jump-zero</a>
                  <a class="nav-link ms-3 my-1" href="#jump-not-zero">jump-not-zero</a>
                  <a class="nav-link ms-3 my-1" href="#jump-gt-zero">jump-gt-zero</a>
                  <a class="nav-link ms-3 my-1" href="#jump-lt-zero">jump-lt-zero</a>
                  <a class="nav-link ms-3 my-1" href="#return">return</a>
                  <a class="nav-link ms-3 my-1" href="#halt">halt</a>
                  <a class="nav-link ms-3 my-1" href="#add">add</a>
                  <a class="nav-link ms-3 my-1" href="#subtract">subtract</a>
                  <a class="nav-link ms-3 my-1" href="#multiply">multiply</a>
                  <a class="nav-link ms-3 my-1" href="#divide">divide</a>
                  <a class="nav-link ms-3 my-1" href="#shift-left">shift-left</a>
                  <a class="nav-link ms-3 my-1" href="#shift-right">shift-right</a>
                  <a class="nav-link ms-3 my-1" href="#bit-and">bit-and</a>
                  <a class="nav-link ms-3 my-1" href="#bit-or">bit-or</a>
                  <a class="nav-link ms-3 my-1" href="#bit-negate">bit-negate</a>
                  <a class="nav-link ms-3 my-1" href="#bit-xor">bit-xor</a>
                  <a class="nav-link ms-3 my-1" href="#no-operation">no-operation</a>
                  <a class="nav-link ms-3 my-1" href="#print-char">print-char</a>
                  <a class="nav-link ms-3 my-1" href="#print-integer">print-integer</a>
                  <a class="nav-link ms-3 my-1" href="#open-file-input">open-file-input</a>
                  <a class="nav-link ms-3 my-1" href="#open-file-output">open-file-output</a>
                  <a class="nav-link ms-3 my-1" href="#open-client-socket">open-client-socket</a>
                  <a class="nav-link ms-3 my-1" href="#read-port-byte">read-port-byte</a>
                  <a class="nav-link ms-3 my-1" href="#write-port-byte">write-port-byte</a>
                  <a class="nav-link ms-3 my-1" href="#port-has-available">port-has-available</a>
                  <a class="nav-link ms-3 my-1" href="#close-port">close-port</a>

                </nav>
              </nav>
            </nav>
        </div>

        <div class="col-8">
            <div class="overflow-auto vh-100" data-bs-spy="scroll" data-bs-target="#navbar-example3" data-bs-offset="0" tabindex="0">
              <h4 id="overview">Overview</h4>
              <p>
              This document is a manual for the VisualAssembly
              programming language. The VisualAssembly language is an
              emulated low-level environment where instruction blocks are
              connected together to form complete programs.
              </p>
              <h5 id="interface">Interface</h5>
              <p>
              The interface for VisualAssembly consists of 3 major parts:
              The left pane for block selection, the center pane for
              organizing and connecting definitions and instructions,
              and the right pane for inspecting the virtual machine state.
              </p>

              <p>
              Instruction blocks are orange, and contain two dark-orange
              slots of operands, indicated as operands 0 and operand 1.
              Clicking an instruction button in the left pane will add
              an instruction to the center pane, which can be attached to a
              definition block. Operands can be added in a similar way,
              and attached to operand slots in the instruction.
              </p>

              <p>
              Definitions can be created by clicking the
              <b>Create new definition</b> button at the bottom
              of the left pane. Once added, definitions can be called
              by adding a <a href="#call">call</a> instruction with
              operand 0 being set to the hash code of the definition name.
              A hash code is indicated by a constant operand containing a
              string prefixed by <code>#</code> (octothorpe).
              </p>

              <p>
              There are four operand types that can be added and attached
              to instructions:

              <ul>
                  <li><code>Red</code>: Contains a constant value. If the value is prefixed with an octothorpe (#), the string specified afterward will have java's hashCode() method called on the string to convert it to an <code>int</code> value.
                      Note that constants cannot have values assigned
                      to them.
                  </li>
                  <li><code>Green</code>: Specifies a register name. Registers can have values stored into and loaded from them.</li>
                  <li><code>Purple</code>: Points to a word of memory. Memory can be stored into and loaded from.</li>
              </ul>

              <p>
              The right pane shows the current running state, which may be one
              of
              <code>PAUSED</code>, <code>RUNNING</code>, <code>HALTED</code>,
              or <code>ERROR</code>.
              The <code>HALTED</code> and <code>ERROR</code> states require
              machine resets if they are reached.
              </p>

              <p>
              Below the current state is the name of the procecdure that the
              VM is currently executing in. Below that is a listing of the
              current register values. Below the register display is a scroll
              bar that controls the execution speed of the virtual machine.
              Finally, there are two text boxes that serve as the console
              for the machine. The top box displays machine output from
              the <code>#console</code> port, and the bottom box sends
              input to the <code>#console</code> port when enter is pressed.
              <p>

              <h5 id="virtual-machine">Virtual Machine</h5>
              <p>
              The virtual machine emulates a single-core 32 bit
              CPU with a fictional instruction set. The machine has 8
              general-purpose 32-bit registers named <code>r0</code>
              to <code>r7</code>.
              </p>

              <p>
              The VM has 4 control registers, as follows:
              <ul>
                  <li><code>rip</code>: Instruction pointer in the current procedure</li>
                  <li><code>rsp</code>: Stack pointer in memory</li>
                  <li><code>rbp</code>: Stack base pointer in memory (This can optionally be used as a general-purpose register)</li>
                  <li><code>ref</code>: Machine status flags</li>
              </ul>
              </p>

              <p>
              The virtual machine has an array of 16384 32-bit ints
              as memory, which can be indexed from 0 to 16383.
              </p>

              <h4 id="instructions">Instructions</h4>
              <h5 id="push">push</h5>
              <p>
              Pushes operand 0 to the memory located at <code>rsp</code>
              and increments <code>rsp</code>.
              <p>
              <h5 id="pop">pop</h5>
              </p>
              Pops from memory located a <code>rsp</code> into operand 0,
              and decrements <code>rsp</code>.
              <p>
              <h5 id="move">move</h5>
              </p>
              Reads from operand 0, and stores the retrieved value in operand 1.
              <p>
              <h5 id="call">call</h5>
              </p>
              Calls the procedure whose hash code is contained in operand 0.
              <p>
              <h5 id="jump">jump</h5>
              </p>
              Jumps to another instruction relative to the current
              instruction pointer, using operand 0 as an index.
              If the index is out of bounds for the current procedure,
              this results in an error.
              <p>
              <h5 id="jump-zero">jump-zero</h5>
              </p>
              A conditional jump using operand 0 as an index. Jumps only
              if operand 1 is equal to 0.
              If the index is out of bounds for the current procedure,
              this results in an error.
              </p>
              <h5 id="jump-not-zero">jump-not-zero</h5>
              <p>
              A conditional jump using operand 0 as an index. Jumps only
              if operand 1 is not equal to 0.
              If the index is out of bounds for the current procedure,
              this results in an error.
              </p>
              <h5 id="jump-gt-zero">jump-gt-zero</h5>
              <p>
              A conditional jump using operand 0 as an index. Jumps only
              if operand 1 is greater than 0.
              If the index is out of bounds for the current procedure,
              this results in an error.
              </p>
              <h5 id="jump-lt-zero">jump-lt-zero</h5>
              <p>
              A conditional jump using operand 0 as an index. Jumps only
              if operand 1 is less than 0.
              If the index is out of bounds for the current procedure,
              this results in an error.
              </p>
              <h5 id="return">return</h5>
              <p>
              Returns from the procedure currently running to the calling
              procedure. If this is called from the start procedure (which
              has no calling procedure), this results in an error.
              </p>
              <h5 id="halt">halt</h5>
              <p>
              Halts execution. The machine can perform no further
              computation, and must be reset. This usually indicates
              the program was completed successfully.
              </p>
              <h5 id="add">add</h5>
              <p>
              Adds operands 0 and 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="subtract">subtract</h5>
              <p>
              Subtracts operand 1 and from operand 0, then stores the result in <code>r0</code>.
              </p>
              <h5 id="multiply">multiply</h5>
              <p>
              Multiplies operands 0 and 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="divide">divide</h5>
              <p>
              Divides operand 0 by operand 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="shift-left">shift-left</h5>
              <p>
              Bitwise shift operand 0 left by operand 1 places, then stores the result in <code>r0</code>.
              </p>
              <h5 id="shift-right">shift-right</h5>
              <p>
              Bitwise shift operand 0 right by operand 1 places, then stores the result in <code>r0</code>.
              </p>
              <h5 id="bit-and">bit-and</h5>
              <p>
              Performs bitwise 'and' on operand 0 and operand 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="bit-or">bit-or</h5>
              <p>
              Performs bitwise 'or' on operand 0 and operand 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="bit-negate">bit-negate</h5>
              <p>
              Performs bitwise negation on operand 0, then stores the result in <code>r0</code>.
              </p>
              <h5 id="bit-xor">bit-xor</h5>
              <p>
              Performs bitwise exclusive-or on operand 0 and operand 1, then stores the result in <code>r0</code>.
              </p>
              <h5 id="no-operation">no-operation</h5>
              <p>
              Performs no operation.
              </p>
              <h5 id="print-char">print-char</h5>
              <p>
              Displays the ASCII character stored in operand 0 to
              the port currently registered as <code>#console</code>.
              </p>
              <h5 id="print-integer">print-integer</h5>
              <p>
              Displays the integer stored in operand 0 to
              the port currently registered as <code>#console</code>.
              </p>
              <h5 id="open-file-input">open-file-input</h5>
              <p>
              Opens a file as an input port, binding it to the name specified
              in operand 0. Operand 1 specifies the location of the filename
              in memory.
              </p>
              <h5 id="open-file-output">open-file-output</h5>
              <p>
              Opens a file as an output port, binding it to the name specified
              in operand 0. Operand 1 specifies the location of the filename
              in memory.
              </p>
              <h5 id="open-client-socket">open-client-socket</h5>
              <p>
              Opens a TCP connection to the host string specified
              in memory at operand 1. The host string is in the format
              <code>hostname:portnumber</code>. Operand 0 specifies
              the handle at which to bind the port.
              </p>
              <h5 id="read-port-byte">read-port-byte</h5>
              <p>
              Reads a byte from a port and places it in <code>r0</code>,
              if any are available. The port
              handle is specified in operand 0. If no bytes are available,
              this returns -1.
              </p>
              <h5 id="write-port-byte">write-port-byte</h5>
              <p>
              Writes a byte to a port.  The port
              handle is specified in operand 0, and the character to write
              is specified in operand 1.
              </p>
              <h5 id="port-has-available">port-has-available</h5>
              <p>
              If a port has any data available to be read, this stores
              <code>1</code> in <code>r0</code>, or <code>0</code> otherwise.
              The port handle is specified in operand 0.
              </p>
              <h5 id="close-port">close-port</h5>
              <p>
              Closes the port specified in operand 0, and invalidates
              any further uses of the referenced port object in the program.
              </p>
            </div>
        </div>

    </div>
</div>
</body>
